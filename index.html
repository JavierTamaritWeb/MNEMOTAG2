<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>MnemoTag</title>
  
  <!-- Favicon moderno con SVG -->
  <link rel="icon" type="image/svg+xml" href="images/favicon.svg">
  <!-- Fallback para navegadores que no soportan SVG -->
  <link rel="icon" type="image/x-icon" href="images/favicon_io/favicon.ico">
  <!-- Favicon PNG para diferentes tamaños -->
  <link rel="icon" type="image/png" sizes="16x16" href="images/favicon_io/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/favicon_io/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="48x48" href="images/favicon_io/favicon-48x48.png">
  <link rel="icon" type="image/png" sizes="64x64" href="images/favicon_io/favicon-64x64.png">
  <link rel="icon" type="image/png" sizes="96x96" href="images/favicon_io/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="128x128" href="images/favicon_io/favicon-128x128.png">
  <link rel="icon" type="image/png" sizes="256x256" href="images/favicon_io/favicon-256x256.png">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" href="images/favicon_io/apple-touch-icon.png">
  
  <!-- Android/Chrome -->
  <link rel="icon" type="image/png" sizes="192x192" href="images/favicon_io/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/favicon_io/android-chrome-512x512.png">
  
  <!-- Web App Manifest -->
  <link rel="manifest" href="images/favicon_io/site.webmanifest">
  
  <!-- Meta tags para PWA y redes sociales -->
  <meta name="theme-color" content="#20b2aa">
  <meta name="description" content="Editor profesional de metadatos e imágenes. Añade metadatos EXIF, marcas de agua y aplica filtros. Soporte completo para JPEG, PNG, WebP y AVIF.">
  <meta name="keywords" content="editor imágenes, metadatos EXIF, marca de agua, filtros, JPEG, PNG, WebP, AVIF">
  <meta name="author" content="MnemoTag">

  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="css/styles.css">
</head>
<body class="bg-gray-50 min-h-screen">
  <!-- Theme Toggle Button -->
  <button id="theme-toggle" class="theme-toggle" aria-label="Cambiar tema">
    <i id="theme-icon" class="fas fa-moon" aria-hidden="true"></i>
  </button>

  <noscript>
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative">
      <strong class="font-bold">JavaScript desactivado:</strong>
      <span>Esta aplicación requiere JavaScript para funcionar correctamente. Por favor, habilítalo en tu navegador.</span>
    </div>
  </noscript>

  <div class="container mx-auto px-4 py-8 max-w-7xl">
    <!-- Hero Section -->
    <section class="hero-section mb-12">
      <div class="hero-content">
        <div class="hero-logo">
          <img src="images/applicacion.png" alt="MnemoTag Logo" class="hero-logo-image">
        </div>
        <div class="hero-text">
          <h1 class="hero-title">MnemoTag</h1>
          <p class="hero-subtitle">Editor profesional de metadatos e imágenes</p>
          <p class="hero-description">
            Añade metadatos EXIF, marcas de agua y aplica filtros profesionales a tus imágenes. 
            Soporte completo para JPEG, PNG, WebP y AVIF con fallback inteligente.
          </p>
          <div class="hero-features">
            <div class="hero-feature">
              <i class="fas fa-tags"></i>
              <span>Metadatos EXIF</span>
            </div>
            <div class="hero-feature">
              <i class="fas fa-paint-brush"></i>
              <span>Marcas de agua</span>
            </div>
            <div class="hero-feature">
              <i class="fas fa-magic"></i>
              <span>Filtros profesionales</span>
            </div>
            <div class="hero-feature">
              <i class="fas fa-file-image"></i>
              <span>Múltiples formatos</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <main>
      <!-- Upload Zone -->
      <section class="mb-8">
        <div class="bg-white rounded-lg shadow-md p-6 card">
          <h2 class="text-xl font-semibold mb-4">1. Selecciona una imagen</h2>
          <div id="drop-area" class="upload__dropzone rounded-lg cursor-pointer">
            <div class="text-center p-6">
              <i class="fas fa-cloud-upload-alt text-4xl upload__icon" aria-hidden="true"></i>
              <p class="text-gray-700 mb-2 upload-text">Arrastra y suelta tu imagen o</p>
              <button id="file-selector"
                      class="upload__button"
                      aria-label="Seleccionar archivo">
                <i class="fas fa-folder-open" aria-hidden="true"></i>
                Seleccionar archivo
              </button>
              <p class="text-sm text-gray-500 mt-2 upload-info">Formatos: JPG, JPEG, PNG, WEBP, AVIF</p>
              <p class="text-sm text-gray-500 upload-info">Tamaño máximo: <span id="max-file-size">25 MB</span></p>
              <input type="file" id="file-input"
                     accept=".jpg,.jpeg,.png,.webp,.avif"
                     class="hidden"
                     aria-label="Seleccionar archivo de imagen">
            </div>
          </div>
          <div id="file-info" class="file-info file-info--hidden">
            <div class="file-info__content">
              <i class="fas fa-file-image file-info__icon" aria-hidden="true"></i>
              <span id="file-name" class="file-info__name"></span>
              <button id="remove-file"
                      class="file-info__remove"
                      aria-label="Eliminar imagen seleccionada">
                <i class="fas fa-times" aria-hidden="true"></i>
              </button>
            </div>
          </div>
          <div id="error-message"
               class="error error--hidden"
               aria-live="assertive"></div>
        </div>
      </section>

      <div id="editor-container" class="editor-container--hidden">
        <div class="grid--large mb-8">
          <!-- Metadata Section -->
          <section class="mb-8">
            <div class="bg-white rounded-lg shadow-md p-6 card">
              <div id="metadata-header"
                   class="section__header"
                   role="button"
                   tabindex="0"
                   aria-expanded="true"
                   aria-controls="metadata-content">
                <h2 class="text-xl font-semibold">2. Metadatos y Copyright</h2>
                <i class="fas fa-chevron-down section__icon" aria-hidden="true"></i>
              </div>
              <div id="metadata-content"
                   class="section__content section__content--open"
                   aria-hidden="false">
                <div class="section__inner">
                  <form id="metadata-form">
                  <!-- Metadatos básicos -->
                  <div class="metadata-grid">
                    <div class="metadata-field">
                      <label for="metaTitle">Título</label>
                      <input type="text" id="metaTitle" name="metaTitle"
                             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                             placeholder="Título de la imagen">
                      <div class="char-counter" id="title-counter">0/60 caracteres</div>
                    </div>
                    <div class="metadata-field">
                      <label for="metaAuthor">Autor</label>
                      <input type="text" id="metaAuthor" name="metaAuthor"
                             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                             placeholder="Nombre del autor">
                    </div>
                  </div>
                  
                  <!-- Copyright y Licencia -->
                  <div class="metadata-grid">
                    <div class="metadata-field">
                      <label for="metaCopyright">Copyright</label>
                      <div class="copyright-input-group">
                        <input type="text" id="metaCopyright" name="metaCopyright"
                               class="flex-1 px-3 py-2 border border-gray-300 focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                               placeholder="© 2025 Tu Nombre">
                        <button type="button" class="copyright-generator border border-gray-300 px-3" id="autoCopyright" title="Generar copyright automático">
                          <i class="fas fa-magic"></i>
                        </button>
                      </div>
                    </div>
                    <div class="metadata-field">
                      <label for="metaLicense">Licencia</label>
                      <select id="metaLicense" name="metaLicense" class="form-select">
                        <option value="" selected>Seleccionar licencia...</option>
                        <option value="all-rights-reserved">Todos los derechos reservados</option>
                        <option value="cc-by">Creative Commons - Atribución</option>
                        <option value="cc-by-sa">Creative Commons - Atribución-CompartirIgual</option>
                        <option value="cc-by-nc">Creative Commons - Atribución-NoComercial</option>
                        <option value="cc0">Creative Commons Zero (Dominio Público)</option>
                        <option value="royalty-free">Libre de regalías</option>
                      </select>
                    </div>
                  </div>
                  
                  <!-- Fecha de creación -->
                  <div class="mb-6">
                    <label for="creationDate" class="block text-gray-700 font-medium mb-2 form-label">
                      <i class="fas fa-calendar-alt mr-1"></i>Fecha de creación
                    </label>
                    <input type="date" id="creationDate" name="creationDate"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                           placeholder="YYYY-MM-DD">
                    <small class="text-xs text-gray-600 mt-1 block">
                      <i class="fas fa-info-circle mr-1"></i>
                      Se usa la fecha de captura de la imagen. No puede ser futura.
                    </small>
                  </div>
                  
                  <!-- Geolocalización -->
                  <div class="mb-6">
                    <label class="block text-gray-700 font-medium mb-2 form-label">
                      <i class="fas fa-map-marker-alt mr-1"></i>Geolocalización
                      <button type="button" class="gps-button ml-2" id="getCurrentLocation" title="Obtener ubicación actual">
                        <i class="fas fa-crosshairs"></i> Ubicación actual
                      </button>
                    </label>
                    <div class="geo-grid">
                      <input type="number" id="metaLatitude" name="metaLatitude"
                             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                             placeholder="Latitud" step="any">
                      <input type="number" id="metaLongitude" name="metaLongitude"
                             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                             placeholder="Longitud" step="any">
                      <input type="number" id="metaAltitude" name="metaAltitude"
                             class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                             placeholder="Altitud (m)" step="any">
                    </div>
                    <small class="location-status gps-status" id="locationStatus">
                      Haz clic en "Ubicación actual" para obtener coordenadas GPS
                    </small>
                  </div>
                  
                  <!-- Descripción y palabras clave -->
                  <div class="mb-4">
                    <label for="description" class="block text-gray-700 font-medium mb-2 form-label">Descripción</label>
                    <textarea id="description" name="description" rows="3"
                              placeholder="Describe brevemente el contenido de la imagen: paisaje, retrato, evento, objeto, etc. Esta información ayudará a catalogar y encontrar la imagen más fácilmente."
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-textarea"></textarea>
                    <div class="char-counter" id="description-counter">0/160 caracteres</div>
                  </div>
                  <div class="mb-4">
                    <label for="keywords" class="block text-gray-700 font-medium mb-2 form-label">Palabras clave (separadas por comas)</label>
                    <input type="text" id="keywords" name="keywords"
                           placeholder="naturaleza, paisaje, montaña, fotografía, viaje, aventura, cielo, nubes"
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                    <div class="char-counter" id="keywords-counter">0/200 caracteres</div>
                  </div>
                  <div>
                    <button type="submit"
                            class="btn btn-primary button--action">
                      <i class="fas fa-save" aria-hidden="true"></i>
                      Guardar metadatos
                    </button>
                  </div>
                </form>
                
                <!-- Previsualización de metadatos -->
                <div id="metadata-preview" class="metadata-preview--hidden">
                  <div class="mt-6 p-4 bg-gray-50 rounded-lg border-l-4 border-blue-500">
                    <div class="flex justify-between items-center mb-3">
                      <h4 class="text-sm font-semibold text-gray-700 flex items-center">
                        <i class="fas fa-eye mr-2 text-blue-500"></i>
                        Metadatos guardados
                      </h4>
                      <button onclick="hideMetadataPreview()" 
                              class="text-gray-400 hover:text-gray-600 transition-colors"
                              aria-label="Ocultar previsualización">
                        <i class="fas fa-times"></i>
                      </button>
                    </div>
                    <div class="space-y-2 text-sm">
                      <div id="preview-title" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Título:</span>
                        <span class="text-gray-800 ml-2" id="preview-title-value"></span>
                      </div>
                      <div id="preview-author" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Autor:</span>
                        <span class="text-gray-800 ml-2" id="preview-author-value"></span>
                      </div>
                      <div id="preview-copyright" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Copyright:</span>
                        <span class="text-gray-800 ml-2" id="preview-copyright-value"></span>
                      </div>
                      <div id="preview-license" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Licencia:</span>
                        <span class="text-gray-800 ml-2" id="preview-license-value"></span>
                      </div>
                      <div id="preview-location" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Ubicación:</span>
                        <span class="text-gray-800 ml-2" id="preview-location-value"></span>
                      </div>
                      <div id="preview-description" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Descripción:</span>
                        <span class="text-gray-800 ml-2" id="preview-description-value"></span>
                      </div>
                      <div id="preview-keywords" class="preview-field--hidden">
                        <span class="font-medium text-gray-600">Palabras clave:</span>
                        <span class="text-gray-800 ml-2" id="preview-keywords-value"></span>
                      </div>
                    </div>
                  </div>
                </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Watermark Section -->
          <section class="mb-4">
            <div class="bg-white rounded-lg shadow-md p-6 card">
              <div id="watermark-header"
                   class="section__header"
                   role="button"
                   tabindex="0"
                   aria-expanded="true"
                   aria-controls="watermark-content">
                <h2 class="text-xl font-semibold">3. Añadir marca de agua</h2>
                <i class="fas fa-chevron-down section__icon" aria-hidden="true"></i>
              </div>
              <div id="watermark-content"
                   class="section__content section__content--open"
                   aria-hidden="false">
                <div class="section__inner">
                  <form id="watermark-form">
                  <div class="mb-4">
                    <label class="block text-gray-700 font-medium mb-2 form-label">Tipo de marca</label>
                    <div class="flex space-x-4">
                      <label class="inline-flex items-center">
                        <input type="checkbox" id="watermark-text-enabled" name="watermark-text-enabled" checked
                               class="form-checkbox text-blue-500">
                        <span class="ml-2 text-content">Texto</span>
                      </label>
                      <label class="inline-flex items-center">
                        <input type="checkbox" id="watermark-image-enabled" name="watermark-image-enabled"
                               class="form-checkbox text-blue-500">
                        <span class="ml-2 text-content">Imagen</span>
                      </label>
                    </div>
                  </div>

                  <div id="text-watermark-options" class="watermark-options__text">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="mb-4">
                        <label for="watermark-text" class="block text-gray-700 font-medium mb-2 form-label">Texto</label>
                        <input type="text" id="watermark-text" name="watermark-text"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                      </div>
                      <div class="mb-4">
                        <label for="watermark-font" class="block text-gray-700 font-medium mb-2 form-label">Fuente</label>
                        <select id="watermark-font" name="watermark-font"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-select">
                          <option value="Arial">Arial</option>
                          <option value="Helvetica">Helvetica</option>
                          <option value="Times New Roman">Times New Roman</option>
                          <option value="Courier New">Courier New</option>
                          <option value="Georgia">Georgia</option>
                          <option value="Roboto">Roboto</option>
                          <option value="Montserrat">Montserrat</option>
                          <option value="Montserrat Alternates">Montserrat Alternates</option>
                          <option value="Open Sans">Open Sans</option>
                          <option value="Lato">Lato</option>
                          <option value="Poppins">Poppins</option>
                          <option value="Inter">Inter</option>
                          <option value="Playfair Display">Playfair Display</option>
                          <option value="Bebas Neue">Bebas Neue</option>
                          <option value="Dancing Script">Dancing Script</option>
                          <option value="Lobster">Lobster</option>
                        </select>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-color" class="block text-gray-700 font-medium mb-2 form-label">Color</label>
                        <input type="color" id="watermark-color" name="watermark-color" value="#000000"
                               class="w-full h-10 cursor-pointer">
                      </div>
                      <div class="mb-4">
                        <label for="watermark-position" class="block text-gray-700 font-medium mb-2 form-label">Posición</label>
                        <select id="watermark-position" name="watermark-position"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-select">
                          <option value="top-left">Superior izquierda</option>
                          <option value="top-center">Superior centro</option>
                          <option value="top-right">Superior derecha</option>
                          <option value="center-left">Centro izquierda</option>
                          <option value="center">Centro</option>
                          <option value="center-right">Centro derecha</option>
                          <option value="bottom-left">Inferior izquierda</option>
                          <option value="bottom-center">Inferior centro</option>
                          <option value="bottom-right">Inferior derecha</option>
                        </select>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-size" class="block text-gray-700 font-medium mb-2 form-label">Tamaño</label>
                        <div class="flex items-center gap-3">
                          <input type="range" id="watermark-size" name="watermark-size" min="10" max="100" value="30"
                                 class="flex-1">
                          <input type="number" id="watermark-size-num" name="watermark-size-num" min="10" max="100" value="30"
                                 class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm form-input"
                                 inputmode="decimal" aria-live="polite" aria-labelledby="watermark-size">
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                          <span class="range-label">Pequeño</span>
                          <span class="range-label">Grande</span>
                        </div>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-opacity" class="block text-gray-700 font-medium mb-2 form-label">Opacidad</label>
                        <div class="flex items-center gap-3">
                          <input type="range" id="watermark-opacity" name="watermark-opacity" min="0" max="100" value="50"
                                 class="flex-1">
                          <input type="number" id="watermark-opacity-num" name="watermark-opacity-num" min="0" max="100" value="50"
                                 class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm form-input"
                                 inputmode="decimal" aria-live="polite" aria-labelledby="watermark-opacity">
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                          <span class="range-label">Transparente</span>
                          <span class="range-label">Opaco</span>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div id="image-watermark-options" class="watermark-options__image">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                      <div class="mb-4">
                        <label for="watermark-image" class="block text-gray-700 font-medium mb-2 form-label">Imagen de marca</label>
                        <div class="relative">
                          <input type="file" id="watermark-image" name="watermark-image" accept=".png,.webp"
                                 class="hidden">
                          <label for="watermark-image" 
                                 class="flex items-center justify-center gap-2 w-full px-4 py-3 bg-gradient-to-r from-blue-500 to-blue-600 text-white font-medium rounded-lg cursor-pointer hover:from-blue-600 hover:to-blue-700 transition-all duration-200 shadow-md hover:shadow-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path>
                            </svg>
                            <span id="watermark-file-label">Seleccionar archivo</span>
                          </label>
                        </div>
                        <small class="text-xs text-blue-600 mt-1 block">
                          <i class="fas fa-info-circle mr-1"></i>
                          Se priorizan PNG y WebP por soporte de transparencia
                        </small>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-image-size" class="block text-gray-700 font-medium mb-2 form-label">Tamaño</label>
                        <select id="watermark-image-size" name="watermark-image-size"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-select">
                          <option value="small">Pequeño</option>
                          <option value="medium" selected>Mediano</option>
                          <option value="large">Grande</option>
                          <option value="custom">Personalizado</option>
                        </select>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-image-opacity" class="block text-gray-700 font-medium mb-2 form-label">Opacidad</label>
                        <div class="flex items-center gap-3">
                          <input type="range" id="watermark-image-opacity" name="watermark-image-opacity" min="0" max="100" value="50"
                                 class="flex-1">
                          <input type="number" id="watermark-image-opacity-num" name="watermark-image-opacity-num" min="0" max="100" value="50"
                                 class="w-20 px-2 py-1 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 text-center text-sm form-input"
                                 inputmode="decimal" aria-live="polite" aria-labelledby="watermark-image-opacity">
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-1">
                          <span class="range-label">Transparente</span>
                          <span class="range-label">Opaco</span>
                        </div>
                      </div>
                      <div class="mb-4">
                        <label for="watermark-image-position" class="block text-gray-700 font-medium mb-2 form-label">Posición</label>
                        <select id="watermark-image-position" name="watermark-image-position"
                                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-select">
                          <option value="top-left">Superior izquierda</option>
                          <option value="top-center">Superior centro</option>
                          <option value="top-right">Superior derecha</option>
                          <option value="center-left">Centro izquierda</option>
                          <option value="center">Centro</option>
                          <option value="center-right">Centro derecha</option>
                          <option value="bottom-left">Inferior izquierda</option>
                          <option value="bottom-center">Inferior centro</option>
                          <option value="bottom-right">Inferior derecha</option>
                          <option value="custom">Posición personalizada (clic en imagen)</option>
                        </select>
                      </div>
                      <div id="custom-position-info" class="mb-4" style="display: none;">
                        <div class="bg-blue-50 border border-blue-200 rounded-md p-3">
                          <p class="text-sm text-blue-700">
                            <i class="fas fa-info-circle mr-2"></i>
                            Haz clic en la imagen de vista previa para posicionar la marca de agua donde quieras.
                          </p>
                        </div>
                      </div>
                    </div>
                    <div id="watermark-image-custom-size" class="watermark-options__custom-size">
                      <label class="block text-gray-700 font-medium mb-2 form-label">Tamaño personalizado</label>
                      <div class="grid grid-cols-2 gap-4">
                        <div>
                          <label for="watermark-image-width" class="block text-sm text-gray-600 mb-1 form-label">Ancho (px)</label>
                          <input type="number" id="watermark-image-width" name="watermark-image-width" min="10" max="1000"
                                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                        </div>
                        <div>
                          <label for="watermark-image-height" class="block text-sm text-gray-600 mb-1 form-label">Alto (px)</label>
                          <input type="number" id="watermark-image-height" name="watermark-image-height" min="10" max="1000"
                                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                        </div>
                      </div>
                    </div>
                  </div>

                  <div>
                    <button type="submit"
                            class="btn btn-primary button--action">
                      <i class="fas fa-paint-brush" aria-hidden="true"></i>
                      Aplicar marca de agua
                    </button>
                  </div>
                </form>
                </div>
              </div>
            </div>
          </section>
        </div>

        <!-- Filters Section -->
        <section class="mb-8">
          <div class="bg-white rounded-lg shadow-md p-6 card">
            <div id="filters-header"
                 class="section__header"
                 role="button"
                 tabindex="0"
                 aria-expanded="true"
                 aria-controls="filters-content">
              <h2 class="text-xl font-semibold">4. Filtros y Ajustes</h2>
              <i class="fas fa-chevron-down section__icon" aria-hidden="true"></i>
            </div>
            <div id="filters-content"
                 class="section__content section__content--open"
                 aria-hidden="false">
              <div class="section__inner">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                  <!-- Ajustes Básicos -->
                  <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-800">Ajustes Básicos</h3>
                    
                    <div class="space-y-3">
                      <div>
                        <label for="brightness" class="block text-gray-700 font-medium mb-2 form-label">
                          Brillo: <span id="brightness-value">0</span>
                        </label>
                        <input type="range" id="brightness" name="brightness" min="-100" max="100" value="0" 
                               class="w-full slider">
                      </div>
                      
                      <div>
                        <label for="contrast" class="block text-gray-700 font-medium mb-2 form-label">
                          Contraste: <span id="contrast-value">0</span>
                        </label>
                        <input type="range" id="contrast" name="contrast" min="-100" max="100" value="0" 
                               class="w-full slider">
                      </div>
                      
                      <div>
                        <label for="saturation" class="block text-gray-700 font-medium mb-2 form-label">
                          Saturación: <span id="saturation-value">0</span>
                        </label>
                        <input type="range" id="saturation" name="saturation" min="-100" max="100" value="0" 
                               class="w-full slider">
                      </div>
                      
                      <div>
                        <label for="blur" class="block text-gray-700 font-medium mb-2 form-label">
                          Desenfoque: <span id="blur-value">0</span>px
                        </label>
                        <input type="range" id="blur" name="blur" min="0" max="20" value="0" 
                               class="w-full slider">
                      </div>
                    </div>
                  </div>
                  
                  <!-- Filtros Preestablecidos -->
                  <div class="space-y-4">
                    <h3 class="text-lg font-medium text-gray-800">Filtros Preestablecidos</h3>
                    
                    <div class="grid grid-cols-2 gap-3">
                      <button type="button" class="btn btn-outline filter-preset" data-filter="none">
                        Original
                      </button>
                      <button type="button" class="btn btn-outline filter-preset" data-filter="sepia">
                        Sepia
                      </button>
                      <button type="button" class="btn btn-outline filter-preset" data-filter="grayscale">
                        Blanco y Negro
                      </button>
                      <button type="button" class="btn btn-outline filter-preset" data-filter="vintage">
                        Vintage
                      </button>
                      <button type="button" class="btn btn-outline filter-preset" data-filter="cold">
                        Frío
                      </button>
                      <button type="button" class="btn btn-outline filter-preset" data-filter="warm">
                        Cálido
                      </button>
                    </div>
                    
                    <div class="mt-4">
                      <button type="button" id="resetFilters" class="reset-filters-btn">
                        <i class="fas fa-undo" aria-hidden="true"></i>
                        RESETEAR FILTROS
                      </button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Output Settings Section -->
        <section class="mb-8">
          <div class="bg-white rounded-lg shadow-md p-6 card">
            <div id="output-header"
                 class="section__header"
                 role="button"
                 tabindex="0"
                 aria-expanded="true"
                 aria-controls="output-content">
              <h2 class="text-xl font-semibold">5. Configuración de salida</h2>
              <i class="fas fa-chevron-down section__icon" aria-hidden="true"></i>
            </div>
            <div id="output-content"
                 class="section__content section__content--open"
                 aria-hidden="false">
              <div class="section__inner">
                <div class="grid grid-cols-1 gap-6">
                  <!-- Configuración de Calidad y Formato -->
                  <div class="config-grid">
                    <!-- Quality Control -->
                    <div class="config-section">
                      <h4 class="config-title">
                        <i class="fas fa-adjust"></i>Calidad de imagen
                      </h4>
                      <div class="flex gap-3 items-center mb-4">
                        <input type="range" 
                               id="output-quality" 
                               name="output-quality"
                               min="1" 
                               max="100" 
                               value="80"
                               step="1"
                               class="flex-1 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider">
                        <div class="flex items-center gap-2">
                          <input type="number" 
                                 id="quality-number" 
                                 name="quality-number"
                                 min="1" 
                                 max="100" 
                                 value="80"
                                 class="w-16 px-2 py-1 text-sm border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500 text-center">
                          <span class="text-sm font-medium text-gray-600">%</span>
                        </div>
                      </div>
                      <div class="flex justify-between text-xs text-gray-500 mb-4">
                        <span>Baja (1%)</span>
                        <span>Media (50%)</span>
                        <span>Alta (100%)</span>
                      </div>
                      
                      <!-- Quality Progress Bar -->
                      <div class="quality-progress">
                        <div class="flex justify-between items-center mb-2">
                          <span class="text-sm font-medium text-gray-700">Calidad seleccionada:</span>
                          <span id="quality-percentage" class="text-sm font-bold text-blue-600">80%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden border border-gray-300">
                          <div id="quality-bar" 
                               class="h-full transition-all duration-500 rounded-full relative overflow-hidden"
                               style="width: 80%; background: linear-gradient(90deg, #ef4444 0%, #f59e0b 30%, #22c55e 70%, #16a34a 100%);">
                            <div class="absolute inset-0 bg-gradient-to-r from-transparent via-white to-transparent opacity-30 animate-pulse"></div>
                          </div>
                        </div>
                        <div class="flex justify-between text-xs text-gray-500 mt-2">
                          <span class="flex flex-col items-center">
                            <span class="w-2 h-2 bg-red-500 rounded-full mb-1"></span>
                            <span>Baja</span>
                          </span>
                          <span class="flex flex-col items-center">
                            <span class="w-2 h-2 bg-yellow-500 rounded-full mb-1"></span>
                            <span>Media</span>
                          </span>
                          <span class="flex flex-col items-center">
                            <span class="w-2 h-2 bg-green-500 rounded-full mb-1"></span>
                            <span>Alta</span>
                          </span>
                        </div>
                      </div>
                    </div>

                    <!-- Image Resize Section -->
                    <div class="config-section">
                      <h4 class="config-title">
                        <i class="fas fa-expand-arrows-alt"></i>Redimensionar imagen
                      </h4>
                      
                      <!-- Current size display -->
                      <div id="current-size-display" class="mb-3 p-2 bg-gray-50 rounded text-sm hidden">
                        <span class="text-gray-600">Tamaño actual: </span>
                        <span id="current-dimensions" class="font-medium">-</span>
                      </div>
                      
                      <!-- Resize controls -->
                      <div class="space-y-3">
                        <!-- Maintain aspect ratio -->
                        <div class="flex items-center">
                          <input type="checkbox" id="maintain-aspect-ratio" class="mr-2" checked>
                          <label for="maintain-aspect-ratio" class="text-sm cursor-pointer">Mantener proporción</label>
                        </div>
                        
                        <!-- Dimension inputs -->
                        <div class="grid grid-cols-2 gap-3">
                          <div>
                            <label for="resize-width" class="block text-sm font-medium mb-1">Ancho (px)</label>
                            <input type="number" id="resize-width" min="1" max="8192" 
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                          </div>
                          <div>
                            <label for="resize-height" class="block text-sm font-medium mb-1">Alto (px)</label>
                            <input type="number" id="resize-height" min="1" max="8192"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input">
                          </div>
                        </div>
                        
                        <!-- Size presets -->
                        <div>
                          <label class="block text-sm font-medium mb-2">Tamaños predefinidos</label>
                          <div class="grid grid-cols-2 gap-2">
                            <button type="button" class="preset-btn btn-sm" data-width="1920" data-height="1080">
                              Full HD<br><span class="text-xs opacity-75">1920×1080</span>
                            </button>
                            <button type="button" class="preset-btn btn-sm" data-width="1280" data-height="720">
                              HD<br><span class="text-xs opacity-75">1280×720</span>
                            </button>
                            <button type="button" class="preset-btn btn-sm" data-width="800" data-height="600">
                              SVGA<br><span class="text-xs opacity-75">800×600</span>
                            </button>
                            <button type="button" class="preset-btn btn-sm" data-width="1024" data-height="1024">
                              Cuadrado<br><span class="text-xs opacity-75">1024×1024</span>
                            </button>
                            <button type="button" class="preset-btn btn-sm" data-width="1080" data-height="1080">
                              Instagram<br><span class="text-xs opacity-75">1080×1080</span>
                            </button>
                            <button type="button" class="preset-btn btn-sm" data-width="1200" data-height="630">
                              Facebook<br><span class="text-xs opacity-75">1200×630</span>
                            </button>
                          </div>
                        </div>
                        
                        <!-- Resize actions -->
                        <div class="flex gap-2">
                          <button type="button" id="apply-resize" class="btn btn-primary flex-1">
                            <i class="fas fa-check"></i>
                            Aplicar redimensión
                          </button>
                          <button type="button" id="reset-original-size" class="btn btn-secondary">
                            <i class="fas fa-undo"></i>
                            Original
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Image Rotation Section -->
                    <div class="config-section">
                      <h4 class="config-title">
                        <i class="fas fa-redo"></i>Rotación de imagen
                      </h4>
                      
                      <!-- Rotation controls -->
                      <div class="space-y-3">
                        <!-- Current rotation display -->
                        <div id="current-rotation-display" class="p-3 bg-white border border-blue-200 rounded-lg text-sm shadow-sm hidden">
                          <span class="text-gray-700">Rotación actual: </span>
                          <span id="current-rotation" class="font-semibold text-blue-600">0°</span>
                        </div>
                        
                        <!-- Rotation buttons -->
                        <div class="grid grid-cols-2 gap-2 rotation-controls">
                          <button type="button" id="rotate-90" class="btn btn-secondary">
                            <i class="fas fa-redo"></i>
                            90° ↻
                          </button>
                          <button type="button" id="rotate-180" class="btn btn-secondary">
                            <i class="fas fa-sync"></i>
                            180° ↻
                          </button>
                          <button type="button" id="rotate-270" class="btn btn-secondary">
                            <i class="fas fa-undo"></i>
                            270° ↻
                          </button>
                          <button type="button" id="reset-rotation" class="btn btn-outline">
                            <i class="fas fa-compass"></i>
                            Original
                          </button>
                        </div>
                        
                        <!-- Quick actions -->
                        <div class="flex gap-2 button-group">
                          <button type="button" id="flip-horizontal" class="btn btn-outline flex-1">
                            <i class="fas fa-arrows-alt-h"></i>
                            Voltear H
                          </button>
                          <button type="button" id="flip-vertical" class="btn btn-outline flex-1">
                            <i class="fas fa-arrows-alt-v"></i>
                            Voltear V
                          </button>
                        </div>
                      </div>
                    </div>

                    <!-- Format Selection -->
                    <div class="config-section">
                      <h4 class="config-title">
                        <i class="fas fa-file-image"></i>Formato de salida
                      </h4>
                      <select id="output-format" name="output-format"
                              class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input mb-4">
                        <option value="jpeg">JPEG (.jpg)</option>
                        <option value="png">PNG (.png)</option>
                        <option value="webp">WebP (.webp)</option>
                        <option value="avif">AVIF (.avif)</option>
                      </select>
                      
                      <!-- Format Info -->
                      <div id="format-info" class="format-info p-3 bg-blue-50 border border-blue-200 rounded-md format-jpeg">
                        <div class="flex items-start">
                          <i class="fas fa-info-circle text-blue-600 mt-1 mr-2"></i>
                          <div>
                            <p id="format-title" class="text-sm font-medium text-blue-800 mb-1">JPEG (.jpg)</p>
                            <p id="format-description" class="text-xs text-blue-600">Ideal para fotografías, menor tamaño de archivo. No soporta transparencia.</p>
                            <p id="format-compatibility" class="text-xs text-green-600 mt-1">✓ Compatible con todos los navegadores</p>
                            <p id="format-fallback" class="text-xs text-amber-600 mt-1" style="display: none;"></p>
                          </div>
                        </div>
                      </div>
                    </div>

                    <!-- File Name Editor -->
                    <div class="config-section">
                      <h4 class="config-title">
                        <i class="fas fa-signature"></i>Nombre de archivo
                      </h4>
                      <div class="space-y-3">
                        <div>
                          <label for="file-basename" class="block text-sm font-medium text-gray-700 mb-2">
                            Nombre de archivo (sin extensión)
                          </label>
                          <input type="text" 
                                 id="file-basename" 
                                 name="file-basename"
                                 maxlength="60" 
                                 autocomplete="off"
                                 placeholder="imagen"
                                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 form-input"
                                 aria-describedby="file-basename-help file-basename-error">
                          
                          <div id="file-basename-help" class="text-xs text-gray-600 mt-1">
                            <i class="fas fa-info-circle mr-1"></i>
                            Usa letras, números, espacios, guiones y guiones bajos. Máx. 60 caracteres.
                          </div>
                          
                          <div id="file-basename-error" 
                               class="text-xs text-red-600 mt-1 hidden" 
                               aria-live="polite">
                          </div>
                        </div>
                        
                        <!-- Preview del nombre final -->
                        <div id="filename-preview" class="bg-white border border-blue-200 rounded-lg p-3 text-sm shadow-sm hidden">
                          <span class="text-gray-700">Archivo final: </span>
                          <span id="filename-preview-text" class="font-semibold text-blue-600">imagen.jpg</span>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </section>

        <!-- Preview Section - Now below the grid -->
        <section class="mb-8">
          <div class="bg-white rounded-lg shadow-md p-6 card">
            <div class="flex justify-between items-center mb-4">
              <h2 class="text-xl font-semibold">6. Vista previa</h2>
              <div class="flex gap-2">
                <button id="fullscreen-btn" class="btn btn-primary button--action">
                  <i class="fas fa-expand" aria-hidden="true"></i>
                  Pantalla completa
                </button>
              </div>
            </div>
            
            <!-- Image Info Section -->
            <div id="image-info" class="bg-blue-50 border border-blue-200 rounded-md p-3 mb-4 hidden image-info">
              <div class="flex items-start">
                <i class="fas fa-info-circle text-blue-600 mt-1 mr-2"></i>
                <div class="flex-1">
                  <div class="grid grid-cols-2 md:grid-cols-4 gap-3 text-sm image-info">
                    <div class="image-info-item">
                      <span class="text-blue-800 font-medium">Dimensiones:</span>
                      <div id="image-dimensions" class="text-blue-600">-</div>
                    </div>
                    <div>
                      <span class="text-blue-800 font-medium">Tamaño:</span>
                      <div id="image-size" class="text-blue-600">-</div>
                    </div>
                    <div>
                      <span class="text-blue-800 font-medium">Formato:</span>
                      <div id="image-format" class="text-blue-600">-</div>
                    </div>
                    <div>
                      <span class="text-blue-800 font-medium">Píxeles:</span>
                      <div id="image-pixels" class="text-blue-600">-</div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="preview__container preview-container relative">
              <canvas id="preview-canvas" class="preview__canvas"></canvas>
              
              <!-- Controles de Zoom -->
              <div id="zoom-controls" class="zoom-controls hidden">
                <button id="zoom-out-btn" class="zoom-btn" title="Alejar (-)">
                  <i class="fas fa-minus"></i>
                </button>
                <span id="zoom-level" class="zoom-level">100%</span>
                <button id="zoom-in-btn" class="zoom-btn" title="Acercar (+)">
                  <i class="fas fa-plus"></i>
                </button>
                <button id="zoom-reset-btn" class="zoom-btn zoom-reset" title="Restablecer zoom (Ctrl+0)">
                  <i class="fas fa-search"></i>
                </button>
              </div>
            </div>
            <div class="mt-4 flex justify-between gap-3">
              <div class="flex gap-2">
                <button id="undo-btn" class="btn btn-primary button--action" disabled title="⏪ Deshacer última acción&#10;Atajo: ⌘Z">
                  <i class="fas fa-undo-alt" aria-hidden="true"></i>
                  Deshacer
                </button>
                <button id="redo-btn" class="btn btn-primary button--action" disabled title="⏩ Rehacer acción deshecha&#10;Atajo: ⌘⇧Z o ⌘Y">
                  <i class="fas fa-redo-alt" aria-hidden="true"></i>
                  Rehacer
                </button>
              </div>
              <div class="flex gap-2 flex-wrap action-buttons">
                <button id="reset-changes" class="btn btn-primary button--action" title="Restablecer cambios&#10;Atajo: ⌘⇧R">
                  <i class="fas fa-refresh" aria-hidden="true"></i>
                  Restablecer
                </button>
                <button id="download-image" class="btn btn-primary button--action" title="Descargar imagen&#10;Atajo: ⌘S">
                  <i class="fas fa-download" aria-hidden="true"></i>
                  Descargar imagen
                </button>
              </div>
            </div>
            
            <!-- Nuevas Funcionalidades v3.1 -->
            <div class="advanced-tools-container">
              <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3 flex items-center gap-2 uppercase">
                <i class="fas fa-sparkles text-purple-500"></i>
                Herramientas Avanzadas
              </h3>
              <div class="grid grid-cols-2 sm:grid-cols-4 gap-2">
                <button id="batch-mode-btn" class="btn btn-secondary button--feature" title="📦 Procesar múltiples imágenes&#10;Atajo: ⌘B">
                  <i class="fas fa-layer-group"></i>
                  <span>Lote</span>
                </button>
                <button id="text-layers-btn" class="btn btn-secondary button--feature" title="📝 Agregar capas de texto personalizadas&#10;Atajo: ⌘T">
                  <i class="fas fa-text-height"></i>
                  <span>Texto</span>
                </button>
                <button id="crop-mode-btn" class="btn btn-secondary button--feature" title="✂️ Recortar y redimensionar imagen&#10;Atajo: ⌘R">
                  <i class="fas fa-crop-alt"></i>
                  <span>Recortar</span>
                </button>
                <button id="shortcuts-help-btn" class="btn btn-secondary button--feature" title="⌨️ Ver todos los atajos de teclado&#10;Atajo: ⌘⇧?">
                  <i class="fas fa-keyboard"></i>
                  <span>Atajos</span>
                </button>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>

    <!-- ============================== -->
    <!-- MODALES Y PANELES v3.1         -->
    <!-- ============================== -->
    
    <!-- Modal: Batch Processing -->
    <div id="batch-modal" class="modal-overlay" style="display: none;">
      <div class="modal-container modal-large">
        <div class="modal-header">
          <h2 class="modal-title">
            <i class="fas fa-layer-group text-purple-500"></i>
            Procesamiento por Lotes
          </h2>
          <button class="modal-close" onclick="closeBatchModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="modal-body">
          <!-- Drop Zone -->
          <div id="batch-dropzone" class="dropzone">
            <input type="file" id="batch-file-input" multiple accept="image/*" style="display: none;">
            <i class="fas fa-cloud-upload-alt text-6xl text-gray-400 mb-4"></i>
            <p class="text-lg font-semibold text-gray-700 dark:text-gray-300">Arrastra imágenes aquí</p>
            <p class="text-sm text-gray-500 dark:text-gray-400">o haz clic para seleccionar</p>
            <p class="text-xs text-gray-400 dark:text-gray-500 mt-2">Hasta 50 imágenes • Máx 50MB cada una</p>
          </div>
          
          <!-- Lista de imágenes -->
          <div id="batch-images-list" class="mt-4" style="display: none;">
            <div class="flex justify-between items-center mb-3">
              <h3 class="font-semibold text-gray-700 dark:text-gray-300">
                <span id="batch-count">0</span> imágenes cargadas
              </h3>
              <button onclick="clearBatchQueue()" class="text-sm text-red-600 hover:text-red-700">
                <i class="fas fa-trash"></i> Limpiar todo
              </button>
            </div>
            <div id="batch-items" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 max-h-64 overflow-y-auto">
              <!-- Items se agregarán dinámicamente -->
            </div>
          </div>
          
          <!-- Configuración -->
          <div id="batch-config" class="mt-4 p-4 bg-gray-50 dark:bg-gray-800 rounded-lg" style="display: none;">
            <h3 class="font-semibold text-gray-700 dark:text-gray-300 mb-3">Aplicar a todas las imágenes:</h3>
            <div class="space-y-2">
              <label class="flex items-center gap-2">
                <input type="checkbox" id="batch-apply-filters" checked class="form-checkbox">
                <span>Filtros actuales</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" id="batch-apply-watermarks" checked class="form-checkbox">
                <span>Marcas de agua</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" id="batch-apply-text-layers" checked class="form-checkbox">
                <span>Capas de texto</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" id="batch-apply-metadata" class="form-checkbox">
                <span>Metadatos</span>
              </label>
            </div>
          </div>
          
          <!-- Progress -->
          <div id="batch-progress" class="mt-4" style="display: none;">
            <div class="flex justify-between text-sm text-gray-600 dark:text-gray-400 mb-2">
              <span id="batch-progress-text">Procesando...</span>
              <span id="batch-progress-percent">0%</span>
            </div>
            <div class="progress-bar-container">
              <div id="batch-progress-bar" class="progress-bar-fill" style="width: 0%"></div>
            </div>
          </div>
        </div>
        
        <div class="modal-footer">
          <button onclick="closeBatchModal()" class="px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg">
            <i class="fas fa-times"></i> 
            <span>Cancelar</span>
          </button>
          <button id="batch-process-btn" onclick="processBatch()" class="px-6 py-3 bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 text-white font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg disabled:opacity-50 disabled:cursor-not-allowed" disabled>
            <i class="fas fa-play"></i> 
            <span>Procesar</span>
          </button>
          <button id="batch-download-btn" onclick="downloadBatchZip()" class="px-6 py-3 bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 text-white font-semibold rounded-lg transition-all duration-200 flex items-center gap-2 shadow-md hover:shadow-lg" style="display: none;">
            <i class="fas fa-download"></i> 
            <span>Descargar ZIP</span>
          </button>
        </div>
      </div>
    </div>
    
    <!-- Panel: Capas de Texto -->
    <div id="text-layers-panel" class="side-panel" style="display: none;">
      <div class="side-panel-header">
        <h2 class="side-panel-title">
          <i class="fas fa-text-height text-blue-500"></i>
          Capas de Texto
        </h2>
        <button class="side-panel-close" onclick="closeTextLayersPanel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="side-panel-body">
        <!-- Plantillas Rápidas -->
        <div class="mb-4">
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Plantillas Rápidas</h3>
          <div class="grid grid-cols-2 gap-2">
            <button onclick="applyTextTemplate('modern')" class="template-btn">
              <span class="template-name">Moderno</span>
            </button>
            <button onclick="applyTextTemplate('elegant')" class="template-btn">
              <span class="template-name">Elegante</span>
            </button>
            <button onclick="applyTextTemplate('neon')" class="template-btn">
              <span class="template-name">Neon</span>
            </button>
            <button onclick="applyTextTemplate('vintage')" class="template-btn">
              <span class="template-name">Vintage</span>
            </button>
            <button onclick="applyTextTemplate('minimal')" class="template-btn">
              <span class="template-name">Minimal</span>
            </button>
            <button onclick="applyTextTemplate('dramatic')" class="template-btn">
              <span class="template-name">Dramático</span>
            </button>
          </div>
        </div>
        
        <!-- Lista de Capas -->
        <div class="mb-4">
          <div class="flex justify-between items-center mb-2">
            <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300">
              Capas (<span id="text-layers-count">0</span>/10)
            </h3>
            <button onclick="addNewTextLayer()" class="btn-icon-small" title="Nueva capa">
              <i class="fas fa-plus"></i>
            </button>
          </div>
          <div id="text-layers-list" class="space-y-2 max-h-48 overflow-y-auto">
            <p class="text-sm text-gray-500 dark:text-gray-400 text-center py-4">
              No hay capas de texto
            </p>
          </div>
        </div>
        
        <!-- Editor de Capa Activa -->
        <div id="text-layer-editor" class="p-3 bg-gray-50 dark:bg-gray-800 rounded-lg" style="display: none;">
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-3">Editar Capa</h3>
          
          <div class="space-y-3">
            <!-- Texto -->
            <div>
              <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Texto</label>
              <textarea id="text-layer-text" rows="2" class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600"></textarea>
            </div>
            
            <!-- Fuente -->
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Fuente</label>
                <select id="text-layer-font" class="w-full px-2 py-1 border rounded-md dark:bg-gray-700 dark:border-gray-600 text-sm">
                  <option>Roboto</option>
                  <option>Montserrat</option>
                  <option>Montserrat Alternates</option>
                  <option>Bebas Neue</option>
                  <option>Playfair Display</option>
                  <option>Dancing Script</option>
                  <option>Poppins</option>
                  <option>Inter</option>
                  <option>Lobster</option>
                </select>
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Tamaño</label>
                <input type="number" id="text-layer-size" min="10" max="200" value="40" class="w-full px-2 py-1 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
            </div>
            
            <!-- Color -->
            <div>
              <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Color</label>
              <input type="color" id="text-layer-color" value="#ffffff" class="w-full h-10 border rounded-md">
            </div>
            
            <!-- Posición -->
            <div class="grid grid-cols-2 gap-2">
              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">X</label>
                <input type="number" id="text-layer-x" min="0" value="50" class="w-full px-2 py-1 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
              <div>
                <label class="block text-xs font-medium text-gray-700 dark:text-gray-300 mb-1">Y</label>
                <input type="number" id="text-layer-y" min="0" value="50" class="w-full px-2 py-1 border rounded-md dark:bg-gray-700 dark:border-gray-600">
              </div>
            </div>
            
            <!-- Efectos -->
            <div>
              <label class="flex items-center gap-2 mb-2">
                <input type="checkbox" id="text-layer-shadow" class="form-checkbox">
                <span class="text-xs font-medium">Sombra</span>
              </label>
              <label class="flex items-center gap-2">
                <input type="checkbox" id="text-layer-stroke" class="form-checkbox">
                <span class="text-xs font-medium">Borde</span>
              </label>
            </div>
            
            <!-- Botones -->
            <div class="flex gap-2 pt-2">
              <button onclick="updateActiveTextLayer()" class="btn btn-primary btn-sm flex-1">
                <i class="fas fa-check"></i> Aplicar
              </button>
              <button onclick="deleteActiveTextLayer()" class="btn btn-danger btn-sm">
                <i class="fas fa-trash"></i>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- Panel: Crop -->
    <div id="crop-panel" class="side-panel" style="display: none;">
      <div class="side-panel-header">
        <h2 class="side-panel-title">
          <i class="fas fa-crop-alt text-green-500"></i>
          Recortar Imagen
        </h2>
        <button class="side-panel-close" onclick="closeCropPanel()">
          <i class="fas fa-times"></i>
        </button>
      </div>
      
      <div class="side-panel-body">
        <!-- Proporción -->
        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Proporción</label>
          <select id="crop-aspect-ratio" onchange="changeCropAspectRatio()" class="w-full px-3 py-2 border rounded-md dark:bg-gray-700 dark:border-gray-600">
            <option value="free">Libre</option>
            <option value="1:1">Cuadrado (1:1)</option>
            <option value="16:9">Horizontal (16:9)</option>
            <option value="9:16">Vertical (9:16)</option>
            <option value="4:3">Clásico (4:3)</option>
            <option value="3:2">Fotografía (3:2)</option>
            <option value="21:9">Cinemático (21:9)</option>
          </select>
        </div>
        
        <!-- Dimensiones -->
        <div id="crop-info" class="p-3 bg-blue-50 dark:bg-blue-900/20 rounded-lg mb-4">
          <div class="text-sm space-y-1">
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Ancho:</span>
              <span class="font-semibold text-gray-800 dark:text-gray-200" id="crop-width">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Alto:</span>
              <span class="font-semibold text-gray-800 dark:text-gray-200" id="crop-height">-</span>
            </div>
            <div class="flex justify-between">
              <span class="text-gray-600 dark:text-gray-400">Proporción:</span>
              <span class="font-semibold text-gray-800 dark:text-gray-200" id="crop-ratio">-</span>
            </div>
          </div>
        </div>
        
        <!-- Grid -->
        <div class="mb-4">
          <label class="flex items-center gap-2">
            <input type="checkbox" id="crop-show-grid" checked onchange="toggleCropGrid()" class="form-checkbox">
            <span class="text-sm">Mostrar grid de tercios</span>
          </label>
        </div>
        
        <!-- Sugerencias -->
        <div class="mb-4">
          <h3 class="text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2">Sugerencias Automáticas</h3>
          <div class="space-y-2">
            <button onclick="applyCropSuggestion(0)" class="w-full btn btn-outline btn-sm text-left">
              <i class="fas fa-crosshairs"></i> Centrado
            </button>
            <button onclick="applyCropSuggestion(1)" class="w-full btn btn-outline btn-sm text-left">
              <i class="fas fa-th"></i> Regla de Tercios
            </button>
            <button onclick="applyCropSuggestion(2)" class="w-full btn btn-outline btn-sm text-left">
              <i class="fas fa-magic"></i> Contenido Inteligente
            </button>
          </div>
        </div>
        
        <!-- Botones de acción -->
        <div class="space-y-2">
          <button onclick="applyCrop()" class="w-full btn btn-success">
            <i class="fas fa-check"></i> Aplicar Recorte
          </button>
          <button onclick="cancelCrop()" class="w-full btn btn-secondary">
            <i class="fas fa-times"></i> Cancelar
          </button>
        </div>
      </div>
    </div>
    
    <!-- Modal: Atajos de Teclado -->
    <div id="shortcuts-modal" class="modal-overlay" style="display: none;">
      <div class="modal-container">
        <div class="modal-header">
          <h2 class="modal-title">
            <i class="fas fa-keyboard text-indigo-500"></i>
            Atajos de Teclado
          </h2>
          <button class="modal-close" onclick="closeShortcutsModal()">
            <i class="fas fa-times"></i>
          </button>
        </div>
        
        <div class="modal-body">
          <div class="shortcuts-grid">
            <!-- Edición -->
            <div class="shortcut-section">
              <h3 class="shortcut-section-title">Edición</h3>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + Z</kbd>
                <span class="shortcut-desc">Deshacer</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + Z</kbd>
                <span class="shortcut-desc">Rehacer</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + D</kbd>
                <span class="shortcut-desc">Duplicar capa</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">Delete</kbd>
                <span class="shortcut-desc">Eliminar capa</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + R</kbd>
                <span class="shortcut-desc">Restablecer filtros</span>
              </div>
            </div>
            
            <!-- Archivo -->
            <div class="shortcut-section">
              <h3 class="shortcut-section-title">Archivo</h3>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + S</kbd>
                <span class="shortcut-desc">Guardar imagen</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + C</kbd>
                <span class="shortcut-desc">Copiar imagen al portapapeles</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + V</kbd>
                <span class="shortcut-desc">Pegar imagen desde portapapeles</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + X</kbd>
                <span class="shortcut-desc">Exportar como...</span>
              </div>
            </div>
            
            <!-- Herramientas -->
            <div class="shortcut-section">
              <h3 class="shortcut-section-title">Herramientas</h3>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + B</kbd>
                <span class="shortcut-desc">Procesamiento por lotes</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + T</kbd>
                <span class="shortcut-desc">Capas de texto</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + R</kbd>
                <span class="shortcut-desc">Activar recorte</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys"><span class="mod-key">⌘</span> + ⇧ + ?</kbd>
                <span class="shortcut-desc">Mostrar atajos</span>
              </div>
            </div>
            
            <!-- Vista -->
            <div class="shortcut-section">
              <h3 class="shortcut-section-title">Vista</h3>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">Espacio</kbd>
                <span class="shortcut-desc">Ver original (mantener)</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">+</kbd>
                <span class="shortcut-desc">Zoom in</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">-</kbd>
                <span class="shortcut-desc">Zoom out</span>
              </div>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">0</kbd>
                <span class="shortcut-desc">Zoom 100%</span>
              </div>
            </div>
            
            <!-- General -->
            <div class="shortcut-section">
              <h3 class="shortcut-section-title">General</h3>
              <div class="shortcut-item">
                <kbd class="shortcut-keys">Esc</kbd>
                <span class="shortcut-desc">Cancelar operación</span>
              </div>
            </div>
          </div>
          
          <p class="text-xs text-gray-500 dark:text-gray-400 mt-4 text-center">
            <i class="fas fa-info-circle"></i>
            Los atajos nativos de Mac (⌘+C, ⌘+V, ⌘+X) funcionan normalmente en campos de texto
          </p>
        </div>
      </div>
    </div>

    <footer class="mt-12 text-center text-gray-500 text-sm">
      <p class="footer-text">© 2025 MnemoTag. Todos los derechos reservados.</p>
    </footer>
  </div>
    <!-- External Dependencies -->
    <!-- JSZip para batch processing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- Google Fonts API para text layers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    <!-- Scripts -->
  <script src="js/utils/app-config.js"></script>
  <script src="js/utils/helpers.js"></script>
  <script src="js/utils/smart-debounce.js"></script>
  <script src="js/utils/filter-cache.js"></script>
  <script src="js/utils/fallback-processor.js"></script>
  <script src="js/utils/keyboard-shortcuts.js"></script>
  <script src="js/managers/security-manager.js"></script>
  <script src="js/managers/worker-manager.js"></script>
  <script src="js/managers/history-manager.js"></script>
  <script src="js/managers/metadata-manager.js"></script>
  <script src="js/managers/filter-loading-manager.js"></script>
  <script src="js/managers/filter-manager.js"></script>
  <script src="js/managers/ui-manager.js"></script>
  <script src="js/managers/batch-manager.js"></script>
  <script src="js/managers/text-layer-manager.js"></script>
  <script src="js/managers/crop-manager.js"></script>
  <script src="js/main.js"></script>
</body>
</html>
